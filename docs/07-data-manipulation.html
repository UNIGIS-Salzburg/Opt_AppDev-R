<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>7&nbsp; Data Manipulation – Automated Data Processing with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-read-write.html" rel="next">
<link href="./06-functions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link rel="stylesheet" href="css/custom.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-data-manipulation.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Manipulation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://unigis.at/" class="sidebar-logo-link">
      <img src="./branding/UNIGIS_Salzburg_Schriftlogo_v05.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"></a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Automated Data Processing with R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-core-concepts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Core Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-spatial-data-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spatial Data Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-control-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Control Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-data-manipulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-read-write.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Read and Write Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-spatial-data-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Spatial Data Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-data-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Quarto</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Chapter Overview</h2>
   
  <ul>
<li><a href="#preparation" id="toc-preparation" class="nav-link active" data-scroll-target="#preparation"><span class="header-section-number">7.1</span> Preparation</a></li>
  <li>
<a href="#data-manipulation" id="toc-data-manipulation" class="nav-link" data-scroll-target="#data-manipulation"><span class="header-section-number">7.2</span> Data manipulation</a>
  <ul class="collapse">
<li><a href="#summarise" id="toc-summarise" class="nav-link" data-scroll-target="#summarise"><span class="header-section-number">7.2.1</span> Summarise</a></li>
  <li><a href="#select-and-filter" id="toc-select-and-filter" class="nav-link" data-scroll-target="#select-and-filter"><span class="header-section-number">7.2.2</span> Select and filter</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="header-section-number">7.2.3</span> Mutate</a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="header-section-number">7.2.4</span> Arrange</a></li>
  <li><a href="#exercise-data-manipulation" id="toc-exercise-data-manipulation" class="nav-link" data-scroll-target="#exercise-data-manipulation"><span class="header-section-number">7.2.5</span> Exercise: data manipulation</a></li>
  </ul>
</li>
  <li>
<a href="#join" id="toc-join" class="nav-link" data-scroll-target="#join"><span class="header-section-number">7.3</span> Join</a>
  <ul class="collapse">
<li><a href="#exercise-join" id="toc-exercise-join" class="nav-link" data-scroll-target="#exercise-join"><span class="header-section-number">7.3.1</span> Exercise: join</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="datman" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Manipulation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>In most instances, the structure of the available data will not meet the specific requirements needed to perform the analyses you are interested in. Data analysts typically spend most of their time cleaning, filtering, restructuring data as well as harmonizing and joining data from different sources.</p>
<p>In this lesson, you will learn about the fundamental data wrangling operations using the <code>dplyr</code> library from the Tidyverse suite. You’ll also be introduced to <a href="https://tibble.tidyverse.org/" target="_blank">tibbles</a>, a modern take on data frames in R. Tibbles are lightweight and work seamlessly within the Tidyverse ecosystem. For more on tibbles, see <a href="https://r4ds.had.co.nz/tibbles.html" target="_blank">Tibbles in R for Data Science</a>.</p>
<section id="preparation" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="preparation">
<span class="header-section-number">7.1</span> Preparation</h2>
<p>If not already installed on your machine, install both the <code>tidyverse</code> and <code>nycflights13</code> libraries. The installation of libraries is explained in chapter “libraries” of lesson <a href="02-core-concepts.html" target="_blank">Core Concepts</a>.</p>
<p>The code below loads a sample dataset (a <a href="https://tibble.tidyverse.org/" target="_blank">tibble</a>) from the library <code>nycflights13</code> into the variable <code>flights_from_nyc</code>. We will use this sample data in this lesson.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="va">flights_from_nyc</span> <span class="op">&lt;-</span> <span class="fu">nycflights13</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html">flights</a></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The operator <code>::</code> is used to indicate that the function <code>flights</code> (that returns our sample dataset) is situated within the library <code>nycflights13</code>. This helps avoid ambiguities when functions from different loaded libraries have the same names.</p>
<p>In order to run the following data wrangling examples on your machine, add both lines above as well as the code snippets provided in the upcoming examples to a new R script file.</p>
<p>Once you have loaded the flights table, open the <strong>Environment Tab</strong> in RStudio and double-click variable <code>flights_from_nyc</code> to inspect the variable contents.</p>
<blockquote class="blockquote">
<p>Alternatively, you may inspect <code>flights_from_nyc</code> by writing it to the console.</p>
</blockquote>
</section><section id="data-manipulation" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="data-manipulation">
<span class="header-section-number">7.2</span> Data manipulation</h2>
<p>The <code>dplyr</code> library provides a number of functions to investigate the basic characteristics of inputs. For instance, the function <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> can be used to count the number of rows of a data frame or tibble. The code below uses <code>flights_from_nyc</code> as input to this function. The returned row count <code>n</code> is represented in a table.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">n</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">336776</td>
</tr></tbody>
</table>
</div>
</div>
<p>In the example above, we use the pipe operator <code>%&gt;%</code>, a key feature of <code>magrittr</code> and <code>tidyverse</code> syntax. The operator links a sequence of analysis steps, passing <code>flights_from_nyc</code> through <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> and then <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code>. More specifically, the pipe operator passes the left-hand object as the first argument to the right-hand function. This makes the code simpler and more readable.</p>
<p>The same result could be achieved with a traditional approach using an intermediate variable or by nesting functions. However, these methods can make the code less readable compared to using the pipe operator:</p>
<p><strong>Intermediate Variable:</strong></p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cnt</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">flights_from_nyc</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">cnt</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Nested Function:</strong></p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">flights_from_nyc</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is the same. However, nested structures are harder to read. Accordingly, the pipe operator is a powerful tool to simplify your code.</p>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> can also be used to count the number of rows of a table that has the same value for a given column, usually representing a category.</p>
<p>In the example below, the column name <code>origin</code> is provided as an argument to the function <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code>, so rows representing flights from the same origin are counted together – <code>EWR</code> is the Newark Liberty International Airport, <code>JFK</code> is the John F. Kennedy International Airport, and <code>LGA</code> is LaGuardia Airport.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: right;">120835</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: right;">111279</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: right;">104662</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice how the code becomes more readable with each operation on a new line after <code>%&gt;%</code>.</p>
<p>For a deeper understanding of pipe operators, check out the following video.</p>
<div id="fig-vidpip" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-vidpip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe src="https://player.vimeo.com/video/1074652888?h=be7c285395&amp;" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen="">
</iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-vidpip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Worked examples - <code>magrittr</code> and <code>Base R</code> pipe operators
</figcaption></figure>
</div>
<blockquote class="blockquote">
<p><a href="data/pipe.R" target="_blank">Download Worked Example</a></p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>To change the argument placement, use <code>.</code> within the function call. For example, you could explicitly pass variable <code>flights_from_nyc</code> as a first argument by <code>dplyr::count(., origin)</code>. Passing the variable as a second argument <code>dplyr::count(origin, .)</code> will return an error as the data frame is expected as a first input to function <code>count</code>.</p>
</div>
</div>
<section id="summarise" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="summarise">
<span class="header-section-number">7.2.1</span> Summarise</h3>
<p>To carry out more complex aggregations, the function <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> can be used in combination with the function <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> to summarise the values of the rows of a data frame or tibble. Rows having the same value for a selected column (in the example below, the same <code>origin</code>) are grouped together, then values are aggregated based on the defined function (using one or more columns in the calculation).</p>
<p>In the example below, the function <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> is applied to the column <code>distance</code> to calculate a new column <code>mean_distance_traveled_from</code> (the mean distance travelled by flights starting from each airport).</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">origin</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mean_distance_traveled_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: right;">mean_distance_traveled_from</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: right;">1056.7428</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: right;">1266.2491</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: right;">779.8357</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The results show that the average distance covered by flights starting from <code>JFK</code> is significantly higher than flights departing from <code>LGA</code> or <code>EWR</code>.</p>
</section><section id="select-and-filter" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="select-and-filter">
<span class="header-section-number">7.2.2</span> Select and filter</h3>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> can be used to select a subset of <strong>columns</strong>. For instance in the code below, the function <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> is used to select the columns <code>origin</code>, <code>dest</code>, and <code>dep_delay</code>. The function <code>slice_head</code> is used to include only the first <code>n</code> rows in the output.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span>, <span class="va">dep_delay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">dest</th>
<th style="text-align: right;">dep_delay</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">IAH</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">IAH</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">BQN</td>
<td style="text-align: right;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">ATL</td>
<td style="text-align: right;">-6</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> can instead be used to filter <strong>rows</strong> based on a specified condition. In the example below, the output of the <code>filter</code> step only includes the rows where the value of <code>month</code> is <code>11</code> (i.e., the eleventh month, November).</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span>, <span class="va">year</span>, <span class="va">month</span>, <span class="va">day</span>, <span class="va">dep_delay</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">month</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">dest</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">day</th>
<th style="text-align: right;">dep_delay</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">PSE</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">SYR</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">CLT</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-5</td>
</tr>
<tr class="even">
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">IAH</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice how <code>filter</code> is used in combination with <code>select</code>. All functions in the <code>dplyr</code> library can be combined, in any other order that makes logical sense. However, if the <code>select</code> step didn’t include <code>month</code>, that same column couldn’t have been used in the <code>filter</code> step.</p>
</section><section id="mutate" class="level3" data-number="7.2.3"><h3 data-number="7.2.3" class="anchored" data-anchor-id="mutate">
<span class="header-section-number">7.2.3</span> Mutate</h3>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> can be used to add a new column to an output table. The <code>mutate</code> step in the code below adds a new column <code>air_time_hours</code> to the table obtained through the pipe, that is the flight air time in hours, dividing the flight air time in minutes by <code>60</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flight</span>, <span class="va">origin</span>, <span class="va">dest</span>, <span class="va">air_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    air_time_hours <span class="op">=</span> <span class="va">air_time</span> <span class="op">/</span> <span class="fl">60</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">flight</th>
<th style="text-align: left;">origin</th>
<th style="text-align: left;">dest</th>
<th style="text-align: right;">air_time</th>
<th style="text-align: right;">air_time_hours</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1545</td>
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">IAH</td>
<td style="text-align: right;">227</td>
<td style="text-align: right;">3.783333</td>
</tr>
<tr class="even">
<td style="text-align: right;">1714</td>
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">IAH</td>
<td style="text-align: right;">227</td>
<td style="text-align: right;">3.783333</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1141</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">MIA</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">2.666667</td>
</tr>
<tr class="even">
<td style="text-align: right;">725</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">BQN</td>
<td style="text-align: right;">183</td>
<td style="text-align: right;">3.050000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">461</td>
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">ATL</td>
<td style="text-align: right;">116</td>
<td style="text-align: right;">1.933333</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="callout callout-style-default callout-exercisebox callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run the mutate example above in a new script and replace <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/transmute.html">dplyr::transmute</a></code>. What happens to your results?</p>
</div>
</div>
<div class="callout callout-style-simple callout-exercisebox callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>transmute</code> function creates a new data frame containing only column <code>air_time_hours</code>. The function drops other table columns.</p>
</div>
</div>
</div>
</section><section id="arrange" class="level3" data-number="7.2.4"><h3 data-number="7.2.4" class="anchored" data-anchor-id="arrange">
<span class="header-section-number">7.2.4</span> Arrange</h3>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code> sorts a tibble or data frame in ascending order based on the values in the specified column. If a negative sign is specified before the column name, the descending order is used. The code below would produce a table showing all the rows when ordered by descending order of air time.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">flights_from_nyc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">origin</span>, <span class="va">dest</span>, <span class="va">air_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">air_time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: left;">dest</th>
<th style="text-align: right;">air_time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">HNL</td>
<td style="text-align: right;">695</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">HNL</td>
<td style="text-align: right;">691</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">HNL</td>
<td style="text-align: right;">686</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">HNL</td>
<td style="text-align: right;">686</td>
</tr>
<tr class="odd">
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">HNL</td>
<td style="text-align: right;">683</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>In the examples above, we have used <code>slice_head</code> to present only the first <code>n</code> rows in a table, based on the existing order. The result shows that among domestic flights that depart from New York in 2013, the flight from Newark airport (EWR) to Honululu Airport (HNL) has the longest travel time.</p>
</section><section id="exercise-data-manipulation" class="level3" data-number="7.2.5"><h3 data-number="7.2.5" class="anchored" data-anchor-id="exercise-data-manipulation">
<span class="header-section-number">7.2.5</span> Exercise: data manipulation</h3>
<div class="callout callout-style-default callout-exercisebox callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Food and Agriculture Organization (FAO) is a specialized agency of the United Nations that leads international efforts to defeat hunger. On their <a href="http://www.fao.org/home/en/" target="_blank">Website</a> they provide comprehensive datasets on global crop and livestock production. Your task in this exercise is to create a table that shows national African sorghum production in 2019.</p>
</div>
</div>
<ol type="1">
<li>Create an RScript and install or load the libraries <code>tidyverse</code> and <code>knitr</code>, if not done yet.</li>
<li>Bulk download <a href="http://www.fao.org/faostat/en/#data/QCL" target="_blank">African Crop and Livestock Production</a> data as CSV:</li>
</ol>
<div id="fig-fao" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-fao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/FAODataAfrica.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fao-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: FAO Data Download
</figcaption></figure>
</div>
<ol start="3" type="1">
<li>Read data from comma-separated CSV (<code>"Production_Crops_Livestock_E_Africa_NOFLAG.csv"</code>) into your Script.</li>
</ol>
<pre data-echo="FALSE"><code>fao_data &lt;- read.csv(directory as string, header = TRUE, sep = ",")</code></pre>
<ol start="4" type="1">
<li>Use the pipe operator to perform the following operations:
<ol type="a">
<li>Select columns <code>Area</code>, <code>Item</code>, <code>Element</code>, <code>Unit</code> and <code>Y2019</code>
</li>
<li>Filter rows that contain sorghum production (<code>Item == "Sorghum" &amp; Element == "Production"</code>)</li>
<li>Sort the table based on yield in descending order (<code>arrange</code>)</li>
<li>remove rows including <code>No Data</code> by means of function <code><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na()</a></code>
</li>
<li>render the table using the function <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code> of <code>library knitr</code>
</li>
</ol>
</li>
</ol>
<p>See <a href="Solution_Exercise_DataWrangling1.R" target="_blank">our solution</a>!</p>
<p><strong>Note on Encoding:</strong> When working with datasets from various sources, you may encounter encoding errors. If such an issue arises, a simple approach is to specify the encoding in the <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> function. For instance, you can use <code>read.csv(..., fileEncoding = "latin1")</code>. However, the best case would be, to check the original encoding of the data beforehand and match it in your <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> command. Encoding can be tricky, and while it’s outside the scope of this exercise, being aware of it is crucial in data analysis.</p>
</section></section><section id="join" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="join">
<span class="header-section-number">7.3</span> Join</h2>
<p>A join operation combines two tables into one by matching rows that have the same values in a specified column. This operation is usually executed on columns containing identifiers, which are matched through different tables containing different data about the same real-world entities.</p>
<p>For instance, the table created below (data frame <code>city_telephone_prexix</code>) contains the telephone prefixes of three cities.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">city_telephone_prexix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Leicester"</span>, <span class="st">"Birmingham"</span>, <span class="st">"London"</span><span class="op">)</span>,</span>
<span>    telephon_prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0116"</span>, <span class="st">"0121"</span>, <span class="st">"0171"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">city_telephone_prexix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">London</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>That information can be combined with the data present in a second table <code>city_info_wide</code> (see below) through the join operation on the columns containing the city names.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">city_info_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Leicester"</span>, <span class="st">"Nottingham"</span><span class="op">)</span>,</span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">329839</span>, <span class="fl">321500</span><span class="op">)</span>,</span>
<span>    area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">73.3</span>, <span class="fl">74.6</span><span class="op">)</span>,</span>
<span>    density <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4500</span>, <span class="fl">4412</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
</tr>
</tbody>
</table>
</div>
</div>
<blockquote class="blockquote">
<p>Note that data frames in the code above are converted to <a href="https://tibble.tidyverse.org/" target="_blank">tibbles</a>. This step is necessary because the <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code> function requires <code>tibbles</code> as input.</p>
</blockquote>
<p>Joins between two tables can be executed by different join operations. The <code>dplyr</code> library offers join operations, which correspond to <code>SQL</code> joins illustrated in the image below.</p>
<div id="fig-joins" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-joins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/joins.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-joins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Join types. Source: <a href="https://sdesabbata.github.io/r-for-geographic-data-science/table-operations.html" target="_blank">R for Geographic Data Science</a>
</figcaption></figure>
</div>
<p>Please take your time to understand the examples below that show different realizations of joins between table <code>city_telephone_prexix</code> and table <code>city_info_wide</code>.</p>
<p>The first four examples execute the exact same <em>full join</em> operation using three different syntaxes: with or without using the pipe operator and specifying the <code>by</code> argument or not. Note that all those approaches to writing the join are valid and produce the same result. The choice about which approach to use will depend on the code you are writing. In particular, you might find it useful to use the syntax that uses the pipe operator when the join operation is itself only one stem in a series of data manipulation steps. Using the <code>by</code> argument is usually advisable unless you are certain that you aim to join two tables with all and exactly the column that have the same names in the two table.</p>
<p>Note how the result of the join operations is <em>not</em> saved to a variable. The function <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">knitr::kable</a></code> is added after each join operation through a pipe <code>%&gt;%</code> to display the resulting table in a nice format.</p>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Option 1: without using the pipe operator</span></span>
<span><span class="co"># full join verb</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>,</span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="even">
<td style="text-align: left;">London</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Option 2: without using the pipe operator</span></span>
<span><span class="co">#   and without using the argument "by"</span></span>
<span><span class="co">#   as columns have the same name</span></span>
<span><span class="co">#   in the two tables.</span></span>
<span><span class="co"># Same result as Option 1</span></span>
<span><span class="co"># full join verb</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>,</span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="even">
<td style="text-align: left;">London</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Option 3: using the pipe operator</span></span>
<span><span class="co">#   and without using the argument "by"</span></span>
<span><span class="co">#   as columns have the same name</span></span>
<span><span class="co">#   in the two tables.</span></span>
<span><span class="co"># Same result as Option 1 and 2</span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># full join verb</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="even">
<td style="text-align: left;">London</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Option 4: using the pipe operator</span></span>
<span><span class="co">#   and using the argument "by".</span></span>
<span><span class="co"># Same result as Option 1, 2 and 3</span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># full join verb</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="even">
<td style="text-align: left;">London</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Left join</span></span>
<span><span class="co"># Using syntax similar to Option 1 above</span></span>
<span><span class="co"># left join</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>, </span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span>,</span>
<span>    <span class="co"># columns to match</span></span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"city"</span> <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nottingham</td>
<td style="text-align: right;">321500</td>
<td style="text-align: right;">74.6</td>
<td style="text-align: right;">4412</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Right join</span></span>
<span><span class="co"># Using syntax similar to Option 2 above</span></span>
<span><span class="co"># right join verb</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">right_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># left table</span></span>
<span>    <span class="va">city_info_wide</span>, </span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr>
<tr class="even">
<td style="text-align: left;">Birmingham</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">London</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">0171</td>
</tr>
</tbody>
</table>
</div>
</div>
<div style="page-break-after: always;"></div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Inner join</span></span>
<span><span class="co"># Using syntax similar to Option 3 above</span></span>
<span><span class="co"># left table</span></span>
<span><span class="va">city_info_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># inner join</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span></span>
<span>    <span class="co"># right table</span></span>
<span>    <span class="va">city_telephone_prexix</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">population</th>
<th style="text-align: right;">area</th>
<th style="text-align: right;">density</th>
<th style="text-align: left;">telephon_prefix</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">Leicester</td>
<td style="text-align: right;">329839</td>
<td style="text-align: right;">73.3</td>
<td style="text-align: right;">4500</td>
<td style="text-align: left;">0116</td>
</tr></tbody>
</table>
</div>
</div>
<blockquote class="blockquote">
<p>Compare the results of respective full, left, right and inner join operations. Turn to the discussion forum in case you need further explanations.</p>
</blockquote>
<section id="exercise-join" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="exercise-join">
<span class="header-section-number">7.3.1</span> Exercise: join</h3>
<div class="callout callout-style-default callout-exercisebox callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the previous exercise, we created a table that shows national African sorghum production in 2019. In this exercise we will join crop production statistics with a table that contains national boundaries and visualize sorghum production quantities in a simple map.</p>
</div>
</div>
<ol type="1">
<li><p>Create an RScript and install and load the libraries <code>tidyverse</code>, <code>knitr</code>, <code>ggplot2</code> and <code>maps</code>, if not done yet.</p></li>
<li><p>Copy the <a href="Solution_Exercise_DataWrangling1.R" target="_blank">code from the previous exercise</a> into your new RScript. Note that the result of the pipe operations is <em>not</em> saved to a variable. Save it to a variable.</p></li>
<li><p>Use the <code>ggplot2</code> function <a href="https://ggplot2.tidyverse.org/reference/map_data.html" target="_blank"><code>map_data</code></a> to convert the built in sample dataset <code>world</code> (comes with library <a href="https://cran.r-project.org/web/packages/maps/index.html" target="_blank"><code>maps</code></a>) to a data frame:</p></li>
</ol>
<pre data-echo="FALSE"><code>world_ctry &lt;- map_data("world") </code></pre>
<ol start="4" type="1">
<li><p>Inspect the structure of this data frame. Every row represents a node (defined by long/lat) of a polygon feature (national boundaries).</p></li>
<li><p>Join tables (left table: geographic features, right table: sorghum production statistics) based on country names. Make sure to choose a join method (<code>full_join</code>, <code>inner_join</code>, <code>left_join</code> or <code>right_join</code>) that allows for retaining all the geographic features.</p></li>
</ol>
<p><a href="Solution_Exercise_DataWrangling2.R" target="_blank">Our exercise solution</a> creates a simple output map. Don’t worry in Lesson <a href="10-data-viz.html" target="_blank">Data Visualization</a> we will cover visualization methods in more detail.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Take a look at the <a href="https://www.rstudio.com/resources/cheatsheets/" target="_blank">dplyr Cheatsheet</a> which shows the most important dplyr operations at a glance.</p>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-functions.html" class="pagination-link" aria-label="Functions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Functions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-read-write.html" class="pagination-link" aria-label="Read and Write Data">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Read and Write Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright ©, UNIGIS Salzburg</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>